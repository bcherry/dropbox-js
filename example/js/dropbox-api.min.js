function hex_sha1(e){return binb2hex(core_sha1(str2binb(e),e.length*chrsz))}function b64_sha1(e){return binb2b64(core_sha1(str2binb(e),e.length*chrsz))}function str_sha1(e){return binb2str(core_sha1(str2binb(e),e.length*chrsz))}function hex_hmac_sha1(e,t){return binb2hex(core_hmac_sha1(e,t))}function b64_hmac_sha1(e,t){return binb2b64(core_hmac_sha1(e,t))}function str_hmac_sha1(e,t){return binb2str(core_hmac_sha1(e,t))}function sha1_vm_test(){return hex_sha1("abc")=="a9993e364706816aba3e25717850c26c9cd0d89d"}function core_sha1(e,t){e[t>>5]|=128<<24-t%32,e[(t+64>>9<<4)+15]=t;var n=Array(80),r=1732584193,i=-271733879,s=-1732584194,o=271733878,u=-1009589776;for(var a=0;a<e.length;a+=16){var f=r,l=i,c=s,h=o,p=u;for(var d=0;d<80;d++){d<16?n[d]=e[a+d]:n[d]=rol(n[d-3]^n[d-8]^n[d-14]^n[d-16],1);var v=safe_add(safe_add(rol(r,5),sha1_ft(d,i,s,o)),safe_add(safe_add(u,n[d]),sha1_kt(d)));u=o,o=s,s=rol(i,30),i=r,r=v}r=safe_add(r,f),i=safe_add(i,l),s=safe_add(s,c),o=safe_add(o,h),u=safe_add(u,p)}return Array(r,i,s,o,u)}function sha1_ft(e,t,n,r){return e<20?t&n|~t&r:e<40?t^n^r:e<60?t&n|t&r|n&r:t^n^r}function sha1_kt(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function core_hmac_sha1(e,t){var n=str2binb(e);n.length>16&&(n=core_sha1(n,e.length*chrsz));var r=Array(16),i=Array(16);for(var s=0;s<16;s++)r[s]=n[s]^909522486,i[s]=n[s]^1549556828;var o=core_sha1(r.concat(str2binb(t)),512+t.length*chrsz);return core_sha1(i.concat(o),672)}function safe_add(e,t){var n=(e&65535)+(t&65535),r=(e>>16)+(t>>16)+(n>>16);return r<<16|n&65535}function rol(e,t){return e<<t|e>>>32-t}function str2binb(e){var t=Array(),n=(1<<chrsz)-1;for(var r=0;r<e.length*chrsz;r+=chrsz)t[r>>5]|=(e.charCodeAt(r/chrsz)&n)<<32-chrsz-r%32;return t}function binb2str(e){var t="",n=(1<<chrsz)-1;for(var r=0;r<e.length*32;r+=chrsz)t+=String.fromCharCode(e[r>>5]>>>32-chrsz-r%32&n);return t}function binb2hex(e){var t=hexcase?"0123456789ABCDEF":"0123456789abcdef",n="";for(var r=0;r<e.length*4;r++)n+=t.charAt(e[r>>2]>>(3-r%4)*8+4&15)+t.charAt(e[r>>2]>>(3-r%4)*8&15);return n}function binb2b64(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="";for(var r=0;r<e.length*4;r+=3){var i=(e[r>>2]>>8*(3-r%4)&255)<<16|(e[r+1>>2]>>8*(3-(r+1)%4)&255)<<8|e[r+2>>2]>>8*(3-(r+2)%4)&255;for(var s=0;s<4;s++)r*8+s*6>e.length*32?n+=b64pad:n+=t.charAt(i>>6*(3-s)&63)}return n}var OAuth;OAuth==null&&(OAuth={}),OAuth.setProperties=function(t,n){if(t!=null&&n!=null)for(var r in n)t[r]=n[r];return t},OAuth.setProperties(OAuth,{"percentEncode":function(t){if(t==null)return"";if(t instanceof Array){var n="";for(var r=0;r<t.length;++t)n!=""&&(n+="&"),n+=OAuth.percentEncode(t[r]);return n}return t=encodeURIComponent(t),t=t.replace(/\!/g,"%21"),t=t.replace(/\*/g,"%2A"),t=t.replace(/\'/g,"%27"),t=t.replace(/\(/g,"%28"),t=t.replace(/\)/g,"%29"),t},"decodePercent":function(t){return t!=null&&(t=t.replace(/\+/g," ")),decodeURIComponent(t)},"getParameterList":function(t){if(t==null)return[];if(typeof t!="object")return OAuth.decodeForm(t+"");if(t instanceof Array)return t;var n=[];for(var r in t)n.push([r,t[r]]);return n},"getParameterMap":function(t){if(t==null)return{};if(typeof t!="object")return OAuth.getParameterMap(OAuth.decodeForm(t+""));if(t instanceof Array){var n={};for(var r=0;r<t.length;++r){var i=t[r][0];n[i]===undefined&&(n[i]=t[r][1])}return n}return t},"getParameter":function(t,n){if(t instanceof Array){for(var r=0;r<t.length;++r)if(t[r][0]==n)return t[r][1];return null}return OAuth.getParameterMap(t)[n]},"formEncode":function(t){var n="",r=OAuth.getParameterList(t);for(var i=0;i<r.length;++i){var s=r[i][1];s==null&&(s=""),n!=""&&(n+="&"),n+=OAuth.percentEncode(r[i][0])+"="+OAuth.percentEncode(s)}return n},"decodeForm":function(t){var n=[],r=t.split("&");for(var i=0;i<r.length;++i){var s=r[i];if(s=="")continue;var o=s.indexOf("="),u,a;o<0?(u=OAuth.decodePercent(s),a=null):(u=OAuth.decodePercent(s.substring(0,o)),a=OAuth.decodePercent(s.substring(o+1))),n.push([u,a])}return n},"setParameter":function(t,n,r){var i=t.parameters;if(i instanceof Array){for(var s=0;s<i.length;++s)i[s][0]==n&&(r===undefined?i.splice(s,1):(i[s][1]=r,r=undefined));r!==undefined&&i.push([n,r])}else i=OAuth.getParameterMap(i),i[n]=r,t.parameters=i},"setParameters":function(t,n){var r=OAuth.getParameterList(n);for(var i=0;i<r.length;++i)OAuth.setParameter(t,r[i][0],r[i][1])},"completeRequest":function(t,n){t.method==null&&(t.method="GET");var r=OAuth.getParameterMap(t.parameters);r.oauth_consumer_key==null&&OAuth.setParameter(t,"oauth_consumer_key",n.consumerKey||""),r.oauth_token==null&&n.token!=null&&OAuth.setParameter(t,"oauth_token",n.token),r.oauth_version==null&&OAuth.setParameter(t,"oauth_version","1.0"),r.oauth_timestamp==null&&OAuth.setParameter(t,"oauth_timestamp",OAuth.timestamp()),r.oauth_nonce==null&&OAuth.setParameter(t,"oauth_nonce",OAuth.nonce(6)),OAuth.SignatureMethod.sign(t,n)},"setTimestampAndNonce":function(t){OAuth.setParameter(t,"oauth_timestamp",OAuth.timestamp()),OAuth.setParameter(t,"oauth_nonce",OAuth.nonce(6))},"addToURL":function(t,n){newURL=t;if(n!=null){var r=OAuth.formEncode(n);if(r.length>0){var i=t.indexOf("?");i<0?newURL+="?":newURL+="&",newURL+=r}}return newURL},"getAuthorizationHeader":function(t,n){var r='OAuth realm="'+OAuth.percentEncode(t)+'"',i=OAuth.getParameterList(n);for(var s=0;s<i.length;++s){var o=i[s],u=o[0];u.indexOf("oauth_")==0&&(r+=","+OAuth.percentEncode(u)+'="'+OAuth.percentEncode(o[1])+'"')}return r},"correctTimestampFromSrc":function(t){t=t||"oauth_timestamp";var n=document.getElementsByTagName("script");if(n==null||!n.length)return;var r=n[n.length-1].src;if(!r)return;var i=r.indexOf("?");if(i<0)return;parameters=OAuth.getParameterMap(OAuth.decodeForm(r.substring(i+1)));var s=parameters[t];if(s==null)return;OAuth.correctTimestamp(s)},"correctTimestamp":function(t){OAuth.timeCorrectionMsec=t*1e3-(new Date).getTime()},"timeCorrectionMsec":0,"timestamp":function(){var t=(new Date).getTime()+OAuth.timeCorrectionMsec;return Math.floor(t/1e3)},"nonce":function(t){var n=OAuth.nonce.CHARS,r="";for(var i=0;i<t;++i){var s=Math.floor(Math.random()*n.length);r+=n.substring(s,s+1)}return r}}),OAuth.nonce.CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",OAuth.declareClass=function(t,n,r){var i=t[n];t[n]=r;if(r!=null&&i!=null)for(var s in i)s!="prototype"&&(r[s]=i[s]);return r},OAuth.declareClass(OAuth,"SignatureMethod",function(){}),OAuth.setProperties(OAuth.SignatureMethod.prototype,{"sign":function(t){var n=OAuth.SignatureMethod.getBaseString(t),r=this.getSignature(n);return OAuth.setParameter(t,"oauth_signature",r),r},"initialize":function(t,n){var r;n.accessorSecret!=null&&t.length>9&&t.substring(t.length-9)=="-Accessor"?r=n.accessorSecret:r=n.consumerSecret,this.key=OAuth.percentEncode(r)+"&"+OAuth.percentEncode(n.tokenSecret)}}),OAuth.setProperties(OAuth.SignatureMethod,{"sign":function(t,n){var r=OAuth.getParameterMap(t.parameters).oauth_signature_method;if(r==null||r=="")r="HMAC-SHA1",OAuth.setParameter(t,"oauth_signature_method",r);OAuth.SignatureMethod.newMethod(r,n).sign(t)},"newMethod":function(t,n){var r=OAuth.SignatureMethod.REGISTERED[t];if(r!=null){var i=new r;return i.initialize(t,n),i}var s=new Error("signature_method_rejected"),o="";for(var u in OAuth.SignatureMethod.REGISTERED)o!=""&&(o+="&"),o+=OAuth.percentEncode(u);throw s.oauth_acceptable_signature_methods=o,s},"REGISTERED":{},"registerMethodClass":function(t,n){for(var r=0;r<t.length;++r)OAuth.SignatureMethod.REGISTERED[t[r]]=n},"makeSubclass":function(t){var n=OAuth.SignatureMethod,r=function(){n.call(this)};return r.prototype=new n,r.prototype.getSignature=t,r.prototype.constructor=r,r},"getBaseString":function(t){var n=t.action,r=n.indexOf("?"),i;if(r<0)i=t.parameters;else{i=OAuth.decodeForm(n.substring(r+1));var s=OAuth.getParameterList(t.parameters);for(var o=0;o<s.length;++o)i.push(s[o])}return OAuth.percentEncode(t.method.toUpperCase())+"&"+OAuth.percentEncode(OAuth.SignatureMethod.normalizeUrl(n))+"&"+OAuth.percentEncode(OAuth.SignatureMethod.normalizeParameters(i))},"normalizeUrl":function(t){var n=OAuth.SignatureMethod.parseUri(t),r=n.protocol.toLowerCase(),i=n.authority.toLowerCase(),s=r=="http"&&n.port==80||r=="https"&&n.port==443;if(s){var o=i.lastIndexOf(":");o>=0&&(i=i.substring(0,o))}var u=n.path;return u||(u="/"),r+"://"+i+u},"parseUri":function(t){var n={"key":["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],"parser":{"strict":/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/}},r=n.parser.strict.exec(t),i={},s=14;while(s--)i[n.key[s]]=r[s]||"";return i},"normalizeParameters":function(t){if(t==null)return"";var n=OAuth.getParameterList(t),r=[];for(var i=0;i<n.length;++i){var s=n[i];s[0]!="oauth_signature"&&r.push([OAuth.percentEncode(s[0])+" "+OAuth.percentEncode(s[1]),s])}r.sort(function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0});var o=[];for(var u=0;u<r.length;++u)o.push(r[u][1]);return OAuth.formEncode(o)}}),OAuth.SignatureMethod.registerMethodClass(["PLAINTEXT","PLAINTEXT-Accessor"],OAuth.SignatureMethod.makeSubclass(function(t){return this.key})),OAuth.SignatureMethod.registerMethodClass(["HMAC-SHA1","HMAC-SHA1-Accessor"],OAuth.SignatureMethod.makeSubclass(function(t){b64pad="=";var n=b64_hmac_sha1(this.key,t);return n}));try{OAuth.correctTimestampFromSrc()}catch(e){}var hexcase=0,b64pad="",chrsz=8,DropBox=function(e){var t=this;return this.API_VERSION="1",this.API_HOST="https://api.dropbox.com/",this.API_CONTENT_HOST="https://api-content.dropbox.com/",this.AUTH_HOST="https://www.dropbox.com/",this._consumerKey=e.key||"",this._consumerSecret=e.secret||"",this._token=null,this._tokenSecret=null,this._root=e.accessType=="sandbox"?"sandbox":"dropbox",window.location.search&&(window.opener.authTempDropBOX(),window.close()),{"loggedIn":function(e){e(t.localToken.get())},"loggedOut":function(){t.localToken.unset()},"login":function(e){t.localToken.unset(),t.oauthRequestToken({"done":function(n){window.authTempDropBOX=function(){t.oauthAccessToken({"done":function(t){delete window.authTempDropBOX,e(!0)},"error":function(){e(!1)}})},t.oauthAuthorize(window.location.href)},"error":function(){e(!1)}})},"metadata":function(e,n){t.request({"url":"/metadata/"+t._root+encodeURI(e),"method":"GET","dataType":"json","done":n.done,"error":n.error})},"accountInfo":function(e){t.request({"url":"/account/info","method":"GET","dataType":"json","done":e.done,"error":e.error})},"media":function(e,n){t.request({"url":"/media/"+t._root+encodeURI(e),"method":"GET","dataType":"json","done":n.done,"error":n.error})},"put":function(e,n,r){t.request({"host":t.API_CONTENT_HOST,"url":"/files_put/"+t._root+"/"+encodeURI(e),"method":"PUT","dataType":"json","contentType":"text/plain","headers":{"Content-Length":n.length},"data":n,"done":r.done,"error":r.error})},"get":function(e,n,r){t.request({"host":t.API_CONTENT_HOST,"url":"/files/"+t._root+encodeURI(e),"method":"GET","done":r.done,"error":r.error})},"thumbnails":function(e,n,r,i){t.request({"host":t.API_CONTENT_HOST,"url":"/thumbnails/"+t._root+encodeURI(e),"method":"GET","data":{"format":n,"size":r},"done":i.done,"error":i.error})},"search":function(e,n,r){t.request({"host":t.API_HOST,"url":"/search/"+t._root+encodeURI(e),"method":"GET","dataType":"json","data":{"query":n},"done":r.done,"error":r.error})},"shares":function(e,n){t.request({"url":"/shares/"+t._root+encodeURI(e),"method":"POST","dataType":"json","done":n.done,"error":n.error})},"move":function(e,n,r){t.request({"url":"/fileops/move","method":"POST","data":{"root":t._root,"from_path":e,"to_path":n},"dataType":"json","done":r.done,"error":r.error})},"createFolder":function(e,n){t.request({"host":t.API_HOST,"url":"/fileops/create_folder","method":"POST","data":{"root":t._root,"path":e},"dataType":"json","done":n.done,"error":n.error})},"rm":function(e,n){t.request({"url":"/fileops/delete","method":"POST","data":{"root":t._root,"path":e},"dataType":"json","done":n.done,"error":n.error})}}};DropBox.prototype={"oauthRequestToken":function(e){this.request({"url":"/oauth/request_token","method":"POST","error":e.error||!1,"done":function(t){t=this.queryString.parse(t),this._token=t.oauth_token,this._tokenSecret=t.oauth_token_secret,e.done&&e.done(t)}.bind(this)})},"oauthAccessToken":function(e){this.request({"url":"/oauth/access_token","method":"POST","error":e.error||!1,"done":function(t){t=this.queryString.parse(t),this.localToken.set(t.oauth_token,t.oauth_token_secret),e.done&&e.done(t)}.bind(this)})},"oauthAuthorize":function(e){var t=this.AUTH_HOST+this.API_VERSION+"/oauth/authorize"+"?oauth_token="+this._token;return e&&(t+="&oauth_callback="+encodeURIComponent(e)),window.open(t,"about:blank","width=950,height=650")},"queryString":{"set":function(e){var t=[];return e=e||{},Object.keys(e).forEach(function(e){t.push(e+"="+this[e])},e),t.join("&")},"parse":function(e){var t={},n=null;return e.split("&").forEach(function(e){n=e.split("=",2),t[n[0]]=unescape(n[1])}),t}},"localToken":{"unset":function(){window.sessionStorage.removeItem("_dropbox-token"),window.sessionStorage.removeItem("_dropbox-secret")},"set":function(e,t){window.sessionStorage.setItem("_dropbox-token",e),window.sessionStorage.setItem("_dropbox-secret",t)},"get":function(){var e={"token":window.sessionStorage.getItem("_dropbox-token"),"tokenSecret":window.sessionStorage.getItem("_dropbox-secret")};return!e.token||!e.tokenSecret?!1:e}},"request":function(options){var tokenSession=this.localToken.get(),message={},accessor={},http=null,dataSend=null,returnData=null,params={"done":function(e){},"error":function(e){},"host":this.API_HOST,"apiVersion":this.API_VERSION,"headers":{},"contentType":"application/x-www-form-urlencoded"};tokenSession.token&&(this._token=tokenSession.token),tokenSession.tokenSecret&&(this._tokenSecret=tokenSession.tokenSecret),Object.keys(options).forEach(function(e){params[e]=options[e]},options),params.url=params.host+params.apiVersion+params.url,message={"action":params.url,"method":params.method,"parameters":{"oauth_consumer_key":this._consumerKey,"oauth_signature_method":"HMAC-SHA1","oauth_token":this._token}},accessor={"consumerSecret":this._consumerSecret,"tokenSecret":this._tokenSecret},OAuth.setTimestampAndNonce(message),OAuth.SignatureMethod.sign(message,accessor),params.headers.Authorization=OAuth.getAuthorizationHeader("",message.parameters);if(window.XMLHttpRequest)http=new XMLHttpRequest;else if(window.ActiveXObject)try{http=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){params.error({"error":"Browser does not bearable"});return}typeof params.data=="object"?dataSend=this.queryString.set(params.data)||"":dataSend=params.data,params.method=="GET"&&dataSend&&(params.url+="?"+encodeURI(dataSend),dataSend=""),http.open(params.method,params.url,!0),Object.keys(params.headers).forEach(function(e){http.setRequestHeader(e,this[e])},params.headers),params.contentType&&http.setRequestHeader("Content-Type",params.contentType),http.send(dataSend),http.onreadystatechange=function(){http.readyState==4&&(http.status==200?params.done&&params.done(params.dataType=="json"?eval("("+http.responseText+")"):http.responseText,returnData):params.error&&params.error(params.dataType=="json"?eval("("+http.responseText+")"):http.responseText))}}};